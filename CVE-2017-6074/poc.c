#define _GNU_SOURCE

#include <netinet/ip.h>

#include <sys/ioctl.h>
#include <sys/mman.h>
#include <sys/socket.h>
#include <sys/stat.h>
#include <sys/syscall.h>
#include <sys/types.h>
#include <fcntl.h>

#include <stdarg.h>
#include <stdbool.h>
#include <stddef.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#include <arpa/inet.h>

int r[2];
int main()
{
	struct sockaddr_in6 sa1;
	sa1.sin6_family = AF_INET6;
	sa1.sin6_port = htons(20002);
	inet_pton(AF_INET6, "::1", &sa1.sin6_addr);
	sa1.sin6_flowinfo = 0;
	sa1.sin6_scope_id = 0;

	int optval = 8;

	r[0] = socket(PF_INET6, SOCK_DCCP, IPPROTO_IP);

	bind(r[0], &sa1, 0x20);
	listen(r[0], 0x9);

	setsockopt(r[0], IPPROTO_IPV6, IPV6_RECVPKTINFO, &optval, 4);

	r[1] = socket(PF_INET6, SOCK_DCCP, IPPROTO_IP);
	connect(r[1], &sa1, 0x20);

	shutdown(r[0], SHUT_RDWR);

	return 0;
}
